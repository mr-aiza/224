<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>رزرو مراسم | تشریفات رویایی</title>
  <link rel="stylesheet" href="Style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* استایل زیرمنو */
    .submenu {
      background-color: #fce4ec;
      border-radius: 10px;
      border: 1.5px solid #d81b60;
      margin: 10px 0 25px 0;
      padding: 15px 20px;
      display: none;
      box-shadow: 0 3px 8px rgba(216, 27, 96, 0.3);
      color: #880e4f;
    }
    .submenu label {
      margin-right: 20px;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
    }
    /* نمایش زیباتر آیکون در فرم */
    label i.fa-icon {
      margin-left: 8px;
      color: #d81b60;
    }
    /* بخش مهمان‌ها */
    .guest-inputs {
      display: flex;
      gap: 20px;
      margin-bottom: 25px;
      align-items: flex-end;
    }
    .guest-inputs > div {
      flex: 1;
    }
    /* پیام موفقیت و خطا */
    #formSuccess {
      background-color: #d0f0c0;
      border: 1px solid #4caf50;
      padding: 12px 20px;
      border-radius: 10px;
      color: #2e7d32;
      font-weight: 700;
      margin-top: 15px;
    }
    #formError {
      background-color: #f8d7da;
      border: 1px solid #d32f2f;
      padding: 12px 20px;
      border-radius: 10px;
      color: #d32f2f;
      font-weight: 700;
      margin-top: 15px;
    }
    input[readonly] {
      background-color: #f0f0f0;
      color: #333;
    }
  </style>
</head>
<body>

<nav>
  <a href="index.html">خانه</a>
  <a href="services.html">خدمات</a>
  <a href="portfolio.html">نمونه‌کارها</a>
  <a href="booking.html" class="active">رزرو</a>
  <a href="about.html">درباره ما</a>
  <a href="contact.html">تماس با ما</a>
</nav>

<header>
  <h1>رزرو مراسم رویایی شما</h1>
  <p>لطفاً اطلاعات زیر را دقیق وارد کنید و تاریخ آزاد را انتخاب نمایید.</p>
</header>

<main>
  <form id="bookingForm" novalidate>
    <label for="fullname">نام و نام خانوادگی: <i class="fa-solid fa-user fa-icon"></i></label>
    <input type="text" id="fullname" name="fullname" placeholder="مثلاً علی رضایی" required />

    <label for="phone">شماره تماس: <i class="fa-solid fa-phone fa-icon"></i></label>
    <input type="tel" id="phone" name="phone" placeholder="مثلاً 09123456789" pattern="09\d{9}" required />
    <div class="info-text">فرمت شماره: 09xxxxxxxxx</div>

    <label for="email">ایمیل: <i class="fa-solid fa-envelope fa-icon"></i></label>
    <input type="email" id="email" name="email" placeholder="example@mail.com" required />

    <label for="eventDate">تاریخ مراسم: <i class="fa-solid fa-calendar fa-icon"></i></label>
    <input type="date" id="eventDate" name="eventDate" required />
    <div class="info-text">تاریخ‌هایی که رزرو شده‌اند غیرفعال هستند.</div>

    <label for="eventType">نوع مراسم: <i class="fa-solid fa-gift fa-icon"></i></label>
    <select id="eventType" name="eventType" required>
      <option value="" disabled selected>نوع مراسم را انتخاب کنید</option>
      <option value="wedding">عروسی</option>
      <option value="engagement">نامزدی</option>
      <option value="birthday">تولد</option>
      <option value="other">سایر</option>
    </select>

    <fieldset class="checkbox-group">
      <legend>امکانات انتخابی:</legend>

      <label for="fingerFood">
        <input type="checkbox" id="fingerFood" name="services" value="fingerFood" /> فینگر فود
      </label>
      <div id="submenu-fingerFood" class="submenu">
        <label><input type="radio" name="fingerFoodLevel" value="اقتصادی" /> اقتصادی</label>
        <label><input type="radio" name="fingerFoodLevel" value="معمولی" /> معمولی</label>
        <label><input type="radio" name="fingerFoodLevel" value="ویژه" /> ویژه</label>
      </div>

      <label for="flowerDecoration">
        <input type="checkbox" id="flowerDecoration" name="services" value="flowerDecoration" /> گل‌آرایی
      </label>
      <div id="submenu-flowerDecoration" class="submenu">
        <label><input type="radio" name="flowerDecorationLevel" value="اقتصادی" /> اقتصادی</label>
        <label><input type="radio" name="flowerDecorationLevel" value="معمولی" /> معمولی</label>
        <label><input type="radio" name="flowerDecorationLevel" value="ویژه" /> ویژه</label>
      </div>

      <label for="dinner">
        <input type="checkbox" id="dinner" name="services" value="dinner" /> شام
      </label>
      <div id="submenu-dinner" class="submenu">
        <label><input type="radio" name="dinnerType" value="دیس پرس" /> دیس پرس</label>
        <label><input type="radio" name="dinnerType" value="سلف سرویس" /> سلف سرویس</label>
      </div>

      <label for="juice">
        <input type="checkbox" id="juice" name="services" value="juice" /> آب‌میوه
      </label>
      <div id="submenu-juice" class="submenu">
        <label><input type="radio" name="juiceLevel" value="اقتصادی" /> اقتصادی</label>
        <label><input type="radio" name="juiceLevel" value="معمولی" /> معمولی</label>
        <label><input type="radio" name="juiceLevel" value="ویژه" /> ویژه</label>
      </div>
    </fieldset>

    <div class="guest-inputs">
      <div>
        <label for="guestCount">تعداد مهمان‌ها: <i class="fa-solid fa-users fa-icon"></i></label>
        <input type="number" id="guestCount" name="guestCount" min="1" value="1" required />
      </div>
      <div>
        <label for="staffCount">تعداد مهمانداران: <i class="fa-solid fa-user-tie fa-icon"></i></label>
        <input type="number" id="staffCount" name="staffCount" readonly value="1" />
      </div>
    </div>

    <label for="notes">توضیحات اضافی: <i class="fa-solid fa-note-sticky fa-icon"></i></label>
    <textarea id="notes" name="notes" rows="4" placeholder="در صورت نیاز توضیح دهید..."></textarea>

    <label for="trackingCode">کد پیگیری شما: <i class="fa-solid fa-key fa-icon"></i></label>
    <input type="text" id="trackingCode" name="trackingCode" readonly placeholder="کد پیگیری پس از ارسال نمایش داده می‌شود" />

    <input type="submit" value="ارسال رزرو" />
    <div id="formError" class="error-text" style="display:none;"></div>
    <div id="formSuccess" style="display:none;"></div>
  </form>
</main>

<footer>
  &copy; ۲۰۲۵ تشریفات رویایی | همه حقوق محفوظ است.
</footer>

<!-- canvas قلب‌ها -->
<canvas id="hearts"></canvas>

<!-- موزیک پس زمینه -->
<audio id="bgMusic" src="music.mp3" loop></audio>
<button id="audioToggle" aria-label="پخش/توقف موزیک"><i class="fa-solid fa-music"></i></button>

<script src="https://unpkg.com/@persian-date/persian-date/dist/persian-date.min.js"></script>

<script>
  // تابع کمک‌کننده برای فعال/غیرفعال کردن زیرمنوها
  function toggleSubmenu(checkboxId, submenuId) {
    const checkbox = document.getElementById(checkboxId);
    const submenu = document.getElementById(submenuId);
    checkbox.addEventListener('change', () => {
      submenu.style.display = checkbox.checked ? 'block' : 'none';
      if (!checkbox.checked) {
        // پاک کردن انتخاب رادیوهای زیرمنو
        submenu.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
      }
    });
  }
  toggleSubmenu('fingerFood', 'submenu-fingerFood');
  toggleSubmenu('flowerDecoration', 'submenu-flowerDecoration');
  toggleSubmenu('dinner', 'submenu-dinner');
  toggleSubmenu('juice', 'submenu-juice');

  // شمسی‌سازی و تنظیم حداقل تاریخ
  const dateInput = document.getElementById('eventDate');
  const persianDate = window.persianDate;
  function getTodayPersian() {
    const pd = new persianDate();
    return pd.format('YYYY-MM-DD');
  }
  dateInput.min = getTodayPersian();

  // به روز رسانی تعداد مهماندار بر اساس تعداد مهمان
  const guestCountInput = document.getElementById('guestCount');
  const staffCountInput = document.getElementById('staffCount');

  function updateStaffCount() {
    let guests = parseInt(guestCountInput.value);
    if (isNaN(guests) || guests < 1) guests = 1;
    let staff = Math.ceil(guests / 15);
    staffCountInput.value = staff;
  }
  guestCountInput.addEventListener('input', updateStaffCount);
  updateStaffCount();

  // کد پیگیری یکتا
  function generateTrackingCode() {
    const s4 = () => Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
    return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4();
  }

  // کنترل پیام‌ها و ارسال فرم
  const form = document.getElementById('bookingForm');
  const formError = document.getElementById('formError');
  const formSuccess = document.getElementById('formSuccess');
  const trackingCodeInput = document.getElementById('trackingCode');

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    formError.style.display = 'none';
    formSuccess.style.display = 'none';
    formError.textContent = '';
    formSuccess.textContent = '';

    // اعتبارسنجی ساده
    if (!form.fullname.value.trim()) {
      showError('لطفاً نام و نام خانوادگی را وارد کنید.');
      return;
    }
    if (!form.phone.value.trim() || !/^09\d{9}$/.test(form.phone.value.trim())) {
      showError('شماره تماس معتبر نیست. فرمت صحیح: 09xxxxxxxxx');
      return;
    }
    if (!form.email.value.trim()) {
      showError('لطفاً ایمیل را وارد کنید.');
      return;
    }
    if (!form.eventDate.value.trim()) {
      showError('لطفاً تاریخ مراسم را انتخاب کنید.');
      return;
    }
    if (!form.eventType.value.trim()) {
      showError('لطفاً نوع مراسم را انتخاب کنید.');
      return;
    }

    // چک کردن انتخاب زیرمنوها اگر چک باکس تیک خورده
    const services = ['fingerFood', 'flowerDecoration', 'dinner', 'juice'];
    for (const service of services) {
      const checkbox = form[service];
      if (checkbox.checked) {
        const submenuRadios = form.querySelectorAll(`[name="${service}Level"], [name="${service}Type"]`);
        if (![...submenuRadios].some(r => r.checked)) {
          showError(`لطفاً گزینه مربوط به "${checkbox.parentNode.textContent.trim()}" را انتخاب کنید.`);
          return;
        }
      }
    }

    // تولید کد پیگیری
    const trackingCode = generateTrackingCode();
    trackingCodeInput.value = trackingCode;

    // ساخت رشته قرارداد متنی
    let contractText = '';
    contractText += `fullname: ${form.fullname.value.trim()}\n`;
    contractText += `phone: ${form.phone.value.trim()}\n`;
    contractText += `email: ${form.email.value.trim()}\n`;
    contractText += `eventDate: ${form.eventDate.value.trim()}\n`;
    contractText += `eventType: ${form.eventType.value.trim()}\n`;

    // خدمات انتخابی
    let selectedServices = [];
    services.forEach(service => {
      if (form[service].checked) {
        selectedServices.push(service);
        // سطح یا نوع خدمات
        const levelName = service + 'Level';
        const typeName = service + 'Type';
        let value = '';
        if (form[levelName]) {
          const checkedRadio = form.querySelector(`input[name="${levelName}"]:checked`);
          if (checkedRadio) value = checkedRadio.value;
        }
        if (form[typeName]) {
          const checkedRadio = form.querySelector(`input[name="${typeName}"]:checked`);
          if (checkedRadio) value = checkedRadio.value;
        }
        contractText += `${service}: ${value || 'انتخاب نشده'}\n`;
      }
    });
    if (selectedServices.length === 0) {
      contractText += `services: هیچ\n`;
    }

       contractText += `guestCount: ${form.guestCount.value}\n`;
    contractText += `staffCount: ${form.staffCount.value}\n`;
    contractText += `notes: ${form.notes.value.trim()}\n`;
    contractText += `trackingCode: ${trackingCode}\n`;

    // نمایش پیام موفقیت و کد پیگیری زیر فرم
    formSuccess.innerHTML = `رزرو با موفقیت ثبت شد!<br>کد پیگیری شما: <strong>${trackingCode}</strong>`;
    formSuccess.style.display = 'block';

    // دانلود خودکار فایل قرارداد txt
    const blob = new Blob([contractText], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `reservation_${trackingCode}.txt`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);

    // پاک کردن فرم (جز کد پیگیری که لازم داریم)
    form.reset();
    trackingCodeInput.value = trackingCode;
    updateStaffCount();
  });

  function showError(msg) {
    formError.textContent = msg;
    formError.style.display = 'block';
    formSuccess.style.display = 'none';
  }

  // انیمیشن قلب‌ها (کد ساده)
  const canvas = document.getElementById('hearts');
  const ctx = canvas.getContext('2d');
  let hearts = [];
  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  class Heart {
    constructor() {
      this.x = Math.random() * canvas.width;
      this.y = canvas.height + 20;
      this.size = 10 + Math.random() * 20;
      this.speed = 1 + Math.random() * 2;
      this.opacity = 1;
    }
    draw() {
      ctx.fillStyle = `rgba(216,27,96,${this.opacity})`;
      ctx.beginPath();
      let topCurveHeight = this.size * 0.3;
      ctx.moveTo(this.x, this.y);
      ctx.bezierCurveTo(
        this.x, this.y - topCurveHeight,
        this.x - this.size / 2, this.y - topCurveHeight,
        this.x - this.size / 2, this.y - this.size / 1.5
      );
      ctx.bezierCurveTo(
        this.x - this.size / 2, this.y - this.size,
        this.x, this.y - this.size,
        this.x, this.y - this.size / 2
      );
      ctx.bezierCurveTo(
        this.x, this.y - this.size,
        this.x + this.size / 2, this.y - this.size,
        this.x + this.size / 2, this.y - this.size / 1.5
      );
      ctx.bezierCurveTo(
        this.x + this.size / 2, this.y - topCurveHeight,
        this.x, this.y - topCurveHeight,
        this.x, this.y
      );
      ctx.closePath();
      ctx.fill();
    }
    update() {
      this.y -= this.speed;
      this.opacity -= 0.005;
      if (this.opacity <= 0) {
        this.x = Math.random() * canvas.width;
        this.y = canvas.height + 20;
        this.opacity = 1;
        this.speed = 1 + Math.random() * 2;
        this.size = 10 + Math.random() * 20;
      }
    }
  }

  function animateHearts() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (hearts.length < 30) {
      hearts.push(new Heart());
    }
    hearts.forEach(h => {
      h.update();
      h.draw();
    });
    requestAnimationFrame(animateHearts);
  }
  animateHearts();

  // کنترل موزیک پس‌زمینه
  const bgMusic = document.getElementById('bgMusic');
  const audioToggle = document.getElementById('audioToggle');
  audioToggle.addEventListener('click', () => {
    if (bgMusic.paused) {
      bgMusic.play();
      audioToggle.innerHTML = '<i class="fa-solid fa-pause"></i>';
    } else {
      bgMusic.pause();
      audioToggle.innerHTML = '<i class="fa-solid fa-music"></i>';
    }
  });
</script>

</body>
</html>

